{"version":3,"file":"7-b0133f25.js","sources":["../../../.svelte-kit/adapter-node/nodes/7.js","../../../../src/routes/(authenticated)/admin/users/+page.server.ts","../../../../src/routes/(authenticated)/admin/users/+page.server.ts"],"sourcesContent":["import * as server from '../entries/pages/(authenticated)/admin/users/_page.server.ts.js';\n\nexport const index = 7;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(authenticated)/admin/users/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(authenticated)/admin/users/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/7.Lv9ymzFr.js\",\"_app/immutable/chunks/scheduler.RAkbNlF_.js\",\"_app/immutable/chunks/index.5brJxJeu.js\",\"_app/immutable/chunks/each.N9yYRwnS.js\",\"_app/immutable/chunks/FileEditSolid.ms6lgoOX.js\",\"_app/immutable/chunks/bundle-mjs.MFJMrG53.js\",\"_app/immutable/chunks/index.KuOYZF30.js\",\"_app/immutable/chunks/Frame.iI6vPlRK.js\",\"_app/immutable/chunks/Modal.TkqycPy2.js\",\"_app/immutable/chunks/Button.jSWztE31.js\",\"_app/immutable/chunks/Card.MHFaTJAb.js\",\"_app/immutable/chunks/CheckSolid.F3P5LcSA.js\",\"_app/immutable/chunks/TrashBinSolid.9m9EZefE.js\",\"_app/immutable/chunks/CreateUserForm.2wxeZm7h.js\",\"_app/immutable/chunks/index.RB1Qc8eZ.js\",\"_app/immutable/chunks/singletons.LsHtuZJq.js\",\"_app/immutable/chunks/index.XGR6uEzK.js\",\"_app/immutable/chunks/paths.zrnwqn2j.js\",\"_app/immutable/chunks/stores.qfWq5sye.js\",\"_app/immutable/chunks/stringify.ZBF_Z-nX.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n","import { wrapServerLoadWithSentry } from \"@sentry/sveltekit\";import * as userModule from \"/home/vladimir/Sync/ERM/saas/fleet-towit/src/routes/(authenticated)/admin/users/+page.server.ts\";export const load = userModule.load ? wrapServerLoadWithSentry(userModule.load) : undefined;export * from \"/home/vladimir/Sync/ERM/saas/fleet-towit/src/routes/(authenticated)/admin/users/+page.server.ts\";","import { superValidate } from 'sveltekit-superforms/server';\nimport { fail } from '@sveltejs/kit';\nimport type { PageServerLoad } from './$types.js';\n//import { UserSchema, CompanyUserSchema } from '$lib/zod/index.js';\nimport { getAdminCompany, listCompanyUsers, createCompanyUser} from '$lib/actions/admin.js';\nimport { Role } from '@prisma/client';\nimport { z } from 'zod';\n\nlet fixSchema = z.object({\n  role: z.enum(['STAFF', 'ADMIN', 'OWNER']),\n  email: z.string().email(),\n  id: z.string().optional()\n})\n\nexport const load = (async () => {\n    const adminCompany = await getAdminCompany();\n    let userCompanyList = await listCompanyUsers({companyId: adminCompany?.id || ''})\n    \n    const form = await superValidate(fixSchema);\n    return { form: form, users: userCompanyList} \n\n  }) satisfies PageServerLoad\n\nexport const actions = {\n    default: async ({request}) => {\n      const form = await superValidate(request, fixSchema);\n      const adminCompany = await getAdminCompany();\n      console.log(form)\n        if (!form.valid) {\n            console.log('validation fail')\n            return fail(400, { form });\n          }\n        console.log('validation passed')\n        let user = await createCompanyUser({\n          email: form.data.email,\n          companyId: adminCompany?.id || '',\n          userRole: Role[form.data.role]\n        })\n        form.valid = true\n        let userCompanyList = await listCompanyUsers({companyId: adminCompany?.id||''});\n        return {form, users: userCompanyList}\n    } \n}\n\n\n\n\n"],"names":["userModule.load","load"],"mappings":"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"}