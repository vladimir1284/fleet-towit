{"version":3,"file":"8-5aa34803.js","sources":["../../../.svelte-kit/adapter-node/nodes/8.js","../../../../src/routes/(authenticated)/admin/users/update/[userId]/+page.server.ts","../../../../src/routes/(authenticated)/admin/users/update/[userId]/+page.server.ts"],"sourcesContent":["import * as server from '../entries/pages/(authenticated)/admin/users/update/_userId_/_page.server.ts.js';\n\nexport const index = 8;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(authenticated)/admin/users/update/_userId_/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(authenticated)/admin/users/update/[userId]/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/8.Z4U-DAJm.js\",\"_app/immutable/chunks/scheduler.RAkbNlF_.js\",\"_app/immutable/chunks/index.5brJxJeu.js\",\"_app/immutable/chunks/Modal.TkqycPy2.js\",\"_app/immutable/chunks/bundle-mjs.MFJMrG53.js\",\"_app/immutable/chunks/Frame.iI6vPlRK.js\",\"_app/immutable/chunks/CreateUserForm.2wxeZm7h.js\",\"_app/immutable/chunks/Button.jSWztE31.js\",\"_app/immutable/chunks/each.N9yYRwnS.js\",\"_app/immutable/chunks/index.RB1Qc8eZ.js\",\"_app/immutable/chunks/singletons.LsHtuZJq.js\",\"_app/immutable/chunks/index.XGR6uEzK.js\",\"_app/immutable/chunks/paths.zrnwqn2j.js\",\"_app/immutable/chunks/stores.qfWq5sye.js\",\"_app/immutable/chunks/stringify.ZBF_Z-nX.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n","import { wrapServerLoadWithSentry } from \"@sentry/sveltekit\";import * as userModule from \"/home/vladimir/Sync/ERM/saas/fleet-towit/src/routes/(authenticated)/admin/users/update/[userId]/+page.server.ts\";export const load = userModule.load ? wrapServerLoadWithSentry(userModule.load) : undefined;export * from \"/home/vladimir/Sync/ERM/saas/fleet-towit/src/routes/(authenticated)/admin/users/update/[userId]/+page.server.ts\";","import { superValidate } from 'sveltekit-superforms/server';\nimport { fail, redirect } from '@sveltejs/kit';\nimport type { PageServerLoad } from './$types.js';\n//import { UserSchema, CompanyUserSchema } from '$lib/zod/index.js';\nimport { getAdminCompany, updateCompanyUser, getCompanyUser} from '$lib/actions/admin.js';\nimport { Role } from '@prisma/client';\nimport { z } from 'zod';\n\nlet fixSchema = z.object({\n  role: z.enum(['STAFF', 'ADMIN', 'OWNER']),\n  email: z.string().email(),\n  id: z.string().optional(),\n})\n\ntype fixSchemaType = z.infer<typeof fixSchema> \n\nexport const load = (async ({params}) => {\n    const adminCompany = await getAdminCompany();\n    \n\n    let user = await getCompanyUser({companyUserId: params.userId})\n    let data: fixSchemaType = {email: user.user?.email || '', role: user.role || 'STAFF', id: user.id} \n\n    const form = await superValidate(data, fixSchema);\n    return { form: form} \n\n  }) satisfies PageServerLoad\n\nexport const actions = {\n    default: async ({request}) => {\n      const form = await superValidate(request, fixSchema);\n      const adminCompany = await getAdminCompany();\n      console.log(form)\n        if (!form.valid) {\n            console.log('validation fail')\n            return fail(400, { form });\n          }\n        console.log('validation passed')\n        updateCompanyUser({\n          companyUserId: form.data.id||'',\n          email: form.data.email,\n          companyId: adminCompany?.id||'',\n          userRole: Role[form.data.role]\n        })\n        form.valid = true\n        throw redirect(307, '/admin/users')\n    } \n}\n\n\n\n\n"],"names":["userModule.load","load"],"mappings":"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"}